<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outbreak Prediction - Africa Disease Surveillance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c5aa0;
            --secondary: #1e88e5;
            --success: #43a047;
            --warning: #ff9800;
            --danger: #e53935;
            --info: #00acc1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary) 0%, #1a237e 100%);
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 15px 15px 0 0 !important;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 8px;
        }

        .prediction-card {
            border-left: 4px solid var(--warning);
        }

        .risk-high { border-left-color: var(--danger); }
        .risk-medium { border-left-color: var(--warning); }
        .risk-low { border-left-color: var(--success); }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-globe-africa me-2"></i>Africa Disease Surveillance
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Home</a>
                <a class="nav-link" href="/data/submit/">Submit Data</a>
                <a class="nav-link" href="/data/dashboard/">Dashboard</a>
                <a class="nav-link active" href="/ml/predict/">AI Predictions</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-5">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0"><i class="fas fa-brain me-2"></i>Outbreak Risk Prediction</h4>
                    </div>
                    <div class="card-body p-4">
                        <form id="predictionForm">
                            {% csrf_token %}
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Country</label>
                                        <select class="form-select" name="country" required>
                                            <option value="">Select Country</option>
                                            <option value="nigeria">Nigeria</option>
                                            <option value="kenya">Kenya</option>
                                            <option value="south_africa">South Africa</option>
                                            <option value="ghana">Ghana</option>
                                            <option value="ethiopia">Ethiopia</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Disease</label>
                                        <select class="form-select" name="disease" required>
                                            <option value="">Select Disease</option>
                                            <option value="malaria">Malaria</option>
                                            <option value="cholera">Cholera</option>
                                            <option value="measles">Measles</option>
                                            <option value="covid19">COVID-19</option>
                                            <option value="tuberculosis">Tuberculosis</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Region</label>
                                        <input type="text" class="form-control" name="region" placeholder="Enter region or state">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Timeframe (days)</label>
                                        <select class="form-select" name="timeframe" required>
                                            <option value="7">Next 7 days</option>
                                            <option value="14">Next 14 days</option>
                                            <option value="30">Next 30 days</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Historical Data Period</label>
                                <select class="form-select" name="historical_period" required>
                                    <option value="30">Last 30 days</option>
                                    <option value="90">Last 90 days</option>
                                    <option value="180">Last 6 months</option>
                                    <option value="365">Last year</option>
                                </select>
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg" id="predictBtn">
                                    <i class="fas fa-chart-line me-2"></i>Generate Prediction
                                </button>
                            </div>
                        </form>

                        <!-- Prediction Results -->
                        <div id="predictionResults" class="mt-4" style="display: none;">
                            <div class="card prediction-card">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Prediction Results</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row text-center">
                                        <div class="col-md-4 mb-3">
                                            <div class="risk-level" id="riskLevel">
                                                <!-- Dynamic content -->
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="prediction-metric">
                                                <h3 id="probability">--%</h3>
                                                <small class="text-muted">Outbreak Probability</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="prediction-metric">
                                                <h3 id="expectedCases">--</h3>
                                                <small class="text-muted">Expected Cases</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <h6>Key Factors:</h6>
                                        <ul id="keyFactors" class="list-unstyled">
                                            <!-- Dynamic content -->
                                        </ul>
                                    </div>

                                    <div class="alert alert-warning mt-3">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>Disclaimer:</strong> This prediction is based on historical data and machine learning models. Actual outcomes may vary.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Model Information -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>About Our Prediction Model</h5>
                    </div>
                    <div class="card-body">
                        <p>Our machine learning model analyzes historical disease data, environmental factors, and population metrics to predict outbreak risks.</p>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <h6>Model Features:</h6>
                                <ul>
                                    <li>Historical case data</li>
                                    <li>Seasonal patterns</li>
                                    <li>Population density</li>
                                    <li>Weather conditions</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Accuracy Metrics:</h6>
                                <ul>
                                    <li>Overall accuracy: 87%</li>
                                    <li>Precision: 85%</li>
                                    <li>Recall: 89%</li>
                                    <li>Last updated: 1 week ago</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const predictBtn = document.getElementById('predictBtn');
            const originalText = predictBtn.innerHTML;
            
            // Show loading state
            predictBtn.innerHTML = '<span class="loading me-2"></span> Analyzing...';
            predictBtn.disabled = true;

            // Simulate API call (replace with actual API call)
            setTimeout(() => {
                // Mock prediction results
                const mockResults = {
                    risk_level: 'medium',
                    probability: '72',
                    expected_cases: '45-60',
                    key_factors: [
                        'Recent case increase in neighboring regions',
                        'Seasonal patterns indicate higher risk',
                        'Moderate population density',
                        'Average healthcare capacity'
                    ]
                };

                displayResults(mockResults);
                
                // Reset button
                predictBtn.innerHTML = originalText;
                predictBtn.disabled = false;
            }, 2000);
        });

        function displayResults(results) {
            const resultsDiv = document.getElementById('predictionResults');
            const riskLevel = document.getElementById('riskLevel');
            const probability = document.getElementById('probability');
            const expectedCases = document.getElementById('expectedCases');
            const keyFactors = document.getElementById('keyFactors');

            // Update risk level
            riskLevel.className = 'risk-level ' + results.risk_level;
            riskLevel.innerHTML = `
                <h3 class="text-${getRiskColor(results.risk_level)}">${results.risk_level.toUpperCase()} RISK</h3>
                <small class="text-muted">Risk Level</small>
            `;

            // Update metrics
            probability.textContent = results.probability + '%';
            expectedCases.textContent = results.expected_cases;

            // Update key factors
            keyFactors.innerHTML = '';
            results.key_factors.forEach(factor => {
                const li = document.createElement('li');
                li.className = 'mb-1';
                li.innerHTML = `<i class="fas fa-arrow-right text-primary me-2"></i>${factor}`;
                keyFactors.appendChild(li);
            });

            // Show results
            resultsDiv.style.display = 'block';
            
            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function getRiskColor(level) {
            switch(level) {
                case 'high': return 'danger';
                case 'medium': return 'warning';
                case 'low': return 'success';
                default: return 'secondary';
            }
        }
    </script>
</body>
</html>